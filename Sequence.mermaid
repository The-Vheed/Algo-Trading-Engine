sequenceDiagram
    participant Config as YAML Config
    participant CSV as CSV Data
    participant API as Deriv API
    participant DP as DataProvider
    participant IE as IndicatorEngine
    participant RD as RegimeDetector
    participant SE as StrategyEngine
    participant RM as RiskManager
    participant OM as OrderManager
    participant PT as PositionTracker
    participant PERF as PerformanceTracker
    participant AM as AlertManager
    
    Note over Config, AM: System Initialization Phase
    Config->>SE: Load Strategy Config
    Config->>RM: Load Risk Config
    CSV->>DP: Load Historical Data (H1, H4)
    DP->>IE: Provide OHLCV Data
    
    Note over CSV, AM: Real-Time Trading Loop
    loop Every New Candle
        API->>DP: Fetch Latest Candle Data
        DP->>IE: Update Data Store
        
        Note over IE, RD: Market Analysis Phase
        IE->>IE: Calculate ADX (H4)
        IE->>IE: Calculate BBW (Optional)
        IE->>IE: Calculate EMAs (H1, H4)
        IE->>IE: Calculate MACD (H1)
        IE->>IE: Calculate Stochastic (H1)
        IE->>IE: Calculate ATR (H1)
        
        IE->>RD: Provide Indicator Values
        RD->>RD: Determine Market Regime
        RD->>SE: Send Regime (TRENDING/RANGING/NEUTRAL)
        
        Note over SE, RM: Signal Generation Phase
        alt Regime = TRENDING
            SE->>SE: Apply Trend Strategy Rules
            SE->>SE: Check EMA Alignment (H4)
            SE->>SE: Look for Pullback to EMA (H1)
            SE->>SE: Confirm MACD Signal
        else Regime = RANGING
            SE->>SE: Apply Range Strategy Rules
            SE->>SE: Identify S/R Levels (H4)
            SE->>SE: Check Stochastic Levels (H1)
            SE->>SE: Look for Reversal Patterns
        else Regime = NEUTRAL
            SE->>SE: No New Trades
        end
        
        SE->>RM: Send Potential Signal
        RM->>RM: Calculate Position Size
        RM->>RM: Validate Risk Limits
        RM->>RM: Check Account Drawdown
        
        alt Signal Valid & Risk OK
            RM->>OM: Approve Order
            OM->>API: Place Order via Deriv API
            API->>OM: Order Confirmation
            OM->>PT: Register New Position
            PT->>PERF: Update Trade Statistics
            OM->>AM: Send "Position Opened" Alert
        else Signal Invalid or Risk Exceeded
            RM->>AM: Send Risk Alert (if applicable)
        end
    end
    
    Note over PT, AM: Position Management Loop
    loop While Positions Open
        PT->>API: Check Position Status
        PT->>IE: Get Current Price & Indicators
        PT->>PT: Evaluate Exit Conditions
        
        alt Exit Condition Met
            PT->>OM: Request Position Close
            OM->>API: Close Position
            API->>OM: Close Confirmation
            PT->>PERF: Record Completed Trade
            OM->>AM: Send "Position Closed" Alert
        else Continue Holding
            PT->>PT: Update Trailing Stop (if applicable)
        end
    end
    
    Note over PERF, AM: Monitoring & Alerts
    PERF->>PERF: Calculate Performance Metrics
    PERF->>AM: Check Alert Conditions
    
    alt Performance Threshold Breached
        AM->>AM: Generate Alert
    end
    
    alt Regime Change Detected
        RD->>AM: Send Regime Change Alert
    end